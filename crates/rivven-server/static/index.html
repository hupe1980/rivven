<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rivven Dashboard</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script defer src="https://unpkg.com/alpinejs@3.13.5/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #131920;
            --bg-tertiary: #1c232d;
            --bg-hover: #242d3a;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #656d76;
            --accent: #58a6ff;
            --accent-hover: #79b8ff;
            --accent-glow: rgba(88, 166, 255, 0.15);
            --success: #3fb950;
            --success-glow: rgba(63, 185, 80, 0.15);
            --warning: #d29922;
            --warning-glow: rgba(210, 153, 34, 0.15);
            --error: #f85149;
            --error-glow: rgba(248, 81, 73, 0.15);
            --purple: #a371f7;
            --purple-glow: rgba(163, 113, 247, 0.15);
            --border: #21262d;
            --border-light: #30363d;
            --radius: 8px;
            --radius-lg: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        .mono { font-family: 'JetBrains Mono', monospace; font-size: 0.875em; }
        .app { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }
        .logo {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }
        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 15px;
            color: white;
        }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .logo-version {
            font-size: 0.625rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            margin-left: auto;
        }
        .nav { flex: 1; padding: 1rem 0.75rem; overflow-y: auto; }
        .nav-section { margin-bottom: 1.5rem; }
        .nav-section-title {
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            border-radius: var(--radius);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease;
            cursor: pointer;
            position: relative;
        }
        .nav-link:hover { background: var(--bg-hover); color: var(--text-primary); }
        .nav-link.active { background: var(--accent-glow); color: var(--accent); }
        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 24px;
            background: var(--accent);
            border-radius: 0 2px 2px 0;
        }
        .nav-link svg { width: 18px; height: 18px; flex-shrink: 0; opacity: 0.85; }
        .nav-badge {
            margin-left: auto;
            font-size: 0.6875rem;
            padding: 0.125rem 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-weight: 600;
        }
        .sidebar-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .sidebar-stat { display: flex; justify-content: space-between; font-size: 0.75rem; }
        .sidebar-stat-label { color: var(--text-muted); }
        .sidebar-stat-value { color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; }

        /* Main Content */
        .main { flex: 1; margin-left: 260px; min-height: 100vh; display: flex; flex-direction: column; }
        .header {
            height: 60px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-left { display: flex; align-items: center; gap: 1rem; }
        .header-title { font-size: 1rem; font-weight: 600; }
        .header-right { display: flex; align-items: center; gap: 1rem; }
        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .status-dot.connected { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .status-dot.disconnected { background: var(--error); animation: none; }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.9); }
        }
        .refresh-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .refresh-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
        .refresh-btn svg { width: 16px; height: 16px; }
        .refresh-btn.loading svg { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .content { flex: 1; padding: 1.5rem; max-width: 1600px; }
        .view { display: none; }
        .view.active { display: block; }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: var(--accent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .stat-card:hover::before { opacity: 1; }
        .stat-card.purple::before { background: var(--purple); }
        .stat-card.success::before { background: var(--success); }
        .stat-card.warning::before { background: var(--warning); }
        .stat-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 1rem; }
        .stat-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-glow);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .stat-icon svg { width: 20px; height: 20px; color: var(--accent); }
        .stat-icon.purple { background: var(--purple-glow); }
        .stat-icon.purple svg { color: var(--purple); }
        .stat-icon.success { background: var(--success-glow); }
        .stat-icon.success svg { color: var(--success); }
        .stat-icon.warning { background: var(--warning-glow); }
        .stat-icon.warning svg { color: var(--warning); }
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }
        .stat-detail { font-size: 0.75rem; color: var(--text-secondary); }

        /* Table Card */
        .table-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .table-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
        }
        .table-title { display: flex; align-items: center; gap: 0.75rem; font-size: 0.9375rem; font-weight: 600; }
        .table-title-icon {
            width: 28px;
            height: 28px;
            background: var(--accent-glow);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .table-title-icon svg { width: 14px; height: 14px; color: var(--accent); }
        .search-input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.5rem 0.75rem;
            font-size: 0.8125rem;
            color: var(--text-primary);
            width: 200px;
        }
        .search-input::placeholder { color: var(--text-muted); }
        .search-input:focus { outline: none; border-color: var(--accent); }
        table { width: 100%; border-collapse: collapse; }
        th {
            text-align: left;
            padding: 0.75rem 1.25rem;
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }
        td {
            padding: 0.875rem 1.25rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
        }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: var(--bg-hover); }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.625rem;
            font-size: 0.6875rem;
            font-weight: 600;
            border-radius: 4px;
            text-transform: uppercase;
        }
        .badge-success { background: var(--success-glow); color: var(--success); }
        .badge-warning { background: var(--warning-glow); color: var(--warning); }
        .badge-error { background: var(--error-glow); color: var(--error); }
        .badge-info { background: var(--accent-glow); color: var(--accent); }
        .badge-purple { background: var(--purple-glow); color: var(--purple); }
        .badge-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }

        .partition-pills { display: flex; gap: 0.25rem; flex-wrap: wrap; }
        .partition-pill {
            font-size: 0.625rem;
            padding: 0.125rem 0.375rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Lag indicator */
        .lag-indicator { display: flex; align-items: center; gap: 0.5rem; }
        .lag-bar {
            width: 60px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }
        .lag-fill { height: 100%; border-radius: 3px; transition: width 0.3s ease; }
        .lag-fill.good { background: var(--success); }
        .lag-fill.warning { background: var(--warning); }
        .lag-fill.error { background: var(--error); }

        /* Empty State */
        .empty-state { text-align: center; padding: 3rem 2rem; }
        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1.5rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .empty-icon svg { width: 28px; height: 28px; color: var(--text-muted); }
        .empty-state h3 { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .empty-state p { font-size: 0.875rem; color: var(--text-muted); }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
            font-weight: 500;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-secondary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--bg-hover); color: var(--text-primary); }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: var(--accent-hover); }

        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        @media (max-width: 1024px) { .grid-2 { grid-template-columns: 1fr; } }

        .info-row { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--border); }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: var(--text-muted); font-size: 0.8125rem; }
        .info-value { font-family: 'JetBrains Mono', monospace; font-size: 0.8125rem; }

        @media (max-width: 768px) {
            .sidebar { width: 64px; }
            .logo-text, .logo-version, .nav-section-title, .nav-link span, .nav-badge, .sidebar-footer { display: none; }
            .nav-link { justify-content: center; padding: 0.75rem; }
            .main { margin-left: 64px; }
        }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="app" x-data="dashboard()">
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">R</div>
                <span class="logo-text">Rivven</span>
                <span class="logo-version">v0.1</span>
            </div>
            <nav class="nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <a class="nav-link" :class="{ active: currentView === 'overview' }" @click="currentView = 'overview'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" /></svg>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Messaging</div>
                    <a class="nav-link" :class="{ active: currentView === 'topics' }" @click="currentView = 'topics'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" /></svg>
                        <span>Topics</span>
                        <span class="nav-badge" x-text="topics.length"></span>
                    </a>
                    <a class="nav-link" :class="{ active: currentView === 'groups' }" @click="currentView = 'groups'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" /></svg>
                        <span>Consumer Groups</span>
                        <span class="nav-badge" x-text="consumerGroups.length"></span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Cluster</div>
                    <a class="nav-link" :class="{ active: currentView === 'cluster' }" @click="currentView = 'cluster'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" /></svg>
                        <span>Nodes</span>
                    </a>
                    <a class="nav-link" :class="{ active: currentView === 'metrics' }" @click="currentView = 'metrics'">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" /></svg>
                        <span>Metrics</span>
                    </a>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="sidebar-stat">
                    <span class="sidebar-stat-label">Uptime</span>
                    <span class="sidebar-stat-value" x-text="formatUptime(uptimeSecs)"></span>
                </div>
                <div class="sidebar-stat">
                    <span class="sidebar-stat-label">Refreshed</span>
                    <span class="sidebar-stat-value" x-text="lastRefresh ? new Date(lastRefresh).toLocaleTimeString() : '-'"></span>
                </div>
            </div>
        </aside>

        <main class="main">
            <header class="header">
                <div class="header-left">
                    <h1 class="header-title" x-text="viewTitle"></h1>
                </div>
                <div class="header-right">
                    <div class="connection-status">
                        <span class="status-dot" :class="connected ? 'connected' : 'disconnected'"></span>
                        <span x-text="connected ? 'Connected' : 'Disconnected'"></span>
                    </div>
                    <button class="refresh-btn" :class="{ loading: isRefreshing }" @click="refreshData" title="Refresh">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>
                    </button>
                </div>
            </header>

            <div class="content">
                <!-- Overview -->
                <div class="view" :class="{ active: currentView === 'overview' }">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" /></svg>
                                </div>
                                <span class="stat-label">Topics</span>
                            </div>
                            <div class="stat-value" x-text="topics.length"></div>
                            <div class="stat-detail"><span x-text="totalPartitions"></span> partitions</div>
                        </div>
                        <div class="stat-card purple">
                            <div class="stat-header">
                                <div class="stat-icon purple">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" /></svg>
                                </div>
                                <span class="stat-label">Messages</span>
                            </div>
                            <div class="stat-value" x-text="formatNumber(totalMessages)"></div>
                            <div class="stat-detail">across all topics</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-header">
                                <div class="stat-icon success">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" /></svg>
                                </div>
                                <span class="stat-label">Consumer Groups</span>
                            </div>
                            <div class="stat-value" x-text="consumerGroups.length"></div>
                            <div class="stat-detail"><span x-text="totalLag"></span> total lag</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-header">
                                <div class="stat-icon warning">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" /></svg>
                                </div>
                                <span class="stat-label">Connections</span>
                            </div>
                            <div class="stat-value" x-text="serverStatus.active_connections || 0"></div>
                            <div class="stat-detail"><span x-text="formatNumber(serverStatus.total_requests || 0)"></span> requests</div>
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="table-card">
                            <div class="table-header">
                                <div class="table-title">
                                    <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" /></svg></div>
                                    Topics
                                </div>
                                <button class="btn btn-secondary" @click="currentView = 'topics'">View All</button>
                            </div>
                            <template x-if="topics.length > 0">
                                <table>
                                    <thead><tr><th>Topic</th><th>Messages</th><th>Partitions</th></tr></thead>
                                    <tbody>
                                        <template x-for="topic in topics.slice(0, 5)" :key="topic.name">
                                            <tr>
                                                <td class="mono" x-text="topic.name"></td>
                                                <td class="mono" x-text="formatNumber(topic.message_count || 0)"></td>
                                                <td class="mono" x-text="topic.partitions || 1"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </template>
                            <template x-if="topics.length === 0">
                                <div class="empty-state">
                                    <div class="empty-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" /></svg></div>
                                    <h3>No Topics</h3>
                                    <p>Create a topic to get started</p>
                                </div>
                            </template>
                        </div>

                        <div class="table-card">
                            <div class="table-header">
                                <div class="table-title">
                                    <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" /></svg></div>
                                    Consumer Groups
                                </div>
                                <button class="btn btn-secondary" @click="currentView = 'groups'">View All</button>
                            </div>
                            <template x-if="consumerGroups.length > 0">
                                <table>
                                    <thead><tr><th>Group ID</th><th>State</th><th>Lag</th></tr></thead>
                                    <tbody>
                                        <template x-for="group in consumerGroups.slice(0, 5)" :key="group.group_id">
                                            <tr>
                                                <td class="mono" x-text="group.group_id"></td>
                                                <td><span class="badge badge-success"><span class="badge-dot"></span><span x-text="group.state || 'Active'"></span></span></td>
                                                <td>
                                                    <div class="lag-indicator">
                                                        <span class="mono" x-text="formatNumber(group.total_lag || 0)"></span>
                                                        <div class="lag-bar"><div class="lag-fill" :class="getLagClass(group.total_lag)" :style="'width: ' + Math.min(100, (group.total_lag || 0) / 100) + '%'"></div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </template>
                            <template x-if="consumerGroups.length === 0">
                                <div class="empty-state">
                                    <div class="empty-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" /></svg></div>
                                    <h3>No Consumer Groups</h3>
                                    <p>Consumer groups appear when consumers connect</p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" /></svg></div>
                                Server Status
                            </div>
                        </div>
                        <div style="padding: 1rem 1.25rem;">
                            <div class="info-row"><span class="info-label">Status</span><span class="badge" :class="serverStatus.status === 'healthy' ? 'badge-success' : 'badge-warning'" x-text="serverStatus.status || 'Unknown'"></span></div>
                            <div class="info-row"><span class="info-label">Mode</span><span class="info-value" x-text="serverStatus.mode || 'Standalone'"></span></div>
                            <div class="info-row"><span class="info-label">Node ID</span><span class="info-value" x-text="serverStatus.node_id || '-'"></span></div>
                            <div class="info-row"><span class="info-label">Uptime</span><span class="info-value" x-text="formatUptime(uptimeSecs)"></span></div>
                        </div>
                    </div>
                </div>

                <!-- Topics View -->
                <div class="view" :class="{ active: currentView === 'topics' }">
                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" /></svg></div>
                                All Topics
                            </div>
                            <input type="text" class="search-input" placeholder="Search topics..." x-model="topicSearch">
                        </div>
                        <template x-if="filteredTopics.length > 0">
                            <table>
                                <thead><tr><th>Topic Name</th><th>Messages</th><th>Partitions</th><th>Replication</th><th>Status</th></tr></thead>
                                <tbody>
                                    <template x-for="topic in filteredTopics" :key="topic.name">
                                        <tr>
                                            <td>
                                                <div>
                                                    <span class="mono" x-text="topic.name"></span>
                                                    <template x-if="topic.partition_offsets && topic.partition_offsets.length > 0">
                                                        <div class="partition-pills" style="margin-top: 0.25rem;">
                                                            <template x-for="p in topic.partition_offsets.slice(0, 3)" :key="p.partition">
                                                                <span class="partition-pill" x-text="'P' + p.partition + ': ' + formatNumber(p.count)"></span>
                                                            </template>
                                                            <template x-if="topic.partition_offsets.length > 3">
                                                                <span class="partition-pill" x-text="'+' + (topic.partition_offsets.length - 3) + ' more'"></span>
                                                            </template>
                                                        </div>
                                                    </template>
                                                </div>
                                            </td>
                                            <td class="mono" x-text="formatNumber(topic.message_count || 0)"></td>
                                            <td class="mono" x-text="topic.partitions || 1"></td>
                                            <td class="mono" x-text="topic.replication_factor || 1"></td>
                                            <td><span class="badge badge-success"><span class="badge-dot"></span>Active</span></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                        <template x-if="filteredTopics.length === 0">
                            <div class="empty-state">
                                <div class="empty-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /></svg></div>
                                <h3>No Results</h3>
                                <p x-text="topicSearch ? 'No topics match your search' : 'No topics created yet'"></p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Consumer Groups View -->
                <div class="view" :class="{ active: currentView === 'groups' }">
                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" /></svg></div>
                                Consumer Groups
                            </div>
                        </div>
                        <template x-if="consumerGroups.length > 0">
                            <table>
                                <thead><tr><th>Group ID</th><th>State</th><th>Topics</th><th>Total Lag</th></tr></thead>
                                <tbody>
                                    <template x-for="group in consumerGroups" :key="group.group_id">
                                        <tr>
                                            <td class="mono" x-text="group.group_id"></td>
                                            <td><span class="badge badge-success"><span class="badge-dot"></span><span x-text="group.state || 'Active'"></span></span></td>
                                            <td>
                                                <template x-if="group.topics && group.topics.length > 0">
                                                    <div class="partition-pills">
                                                        <template x-for="t in group.topics.slice(0, 3)" :key="t"><span class="partition-pill" x-text="t"></span></template>
                                                        <template x-if="group.topics.length > 3"><span class="partition-pill" x-text="'+' + (group.topics.length - 3)"></span></template>
                                                    </div>
                                                </template>
                                                <template x-if="!group.topics || group.topics.length === 0"><span class="mono">-</span></template>
                                            </td>
                                            <td>
                                                <div class="lag-indicator">
                                                    <span class="mono" x-text="formatNumber(group.total_lag || 0)"></span>
                                                    <div class="lag-bar"><div class="lag-fill" :class="getLagClass(group.total_lag)" :style="'width: ' + Math.min(100, Math.max(5, (group.total_lag || 0) / 100)) + '%'"></div></div>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                        <template x-if="consumerGroups.length === 0">
                            <div class="empty-state">
                                <div class="empty-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" /></svg></div>
                                <h3>No Consumer Groups</h3>
                                <p>Consumer groups will appear when consumers connect</p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Cluster View -->
                <div class="view" :class="{ active: currentView === 'cluster' }">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" /></svg></div>
                                <span class="stat-label">Total Nodes</span>
                            </div>
                            <div class="stat-value" x-text="clusterNodes.length || 1"></div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-header">
                                <div class="stat-icon success"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg></div>
                                <span class="stat-label">Healthy</span>
                            </div>
                            <div class="stat-value" x-text="clusterNodes.filter(n => n.is_healthy !== false).length || 1"></div>
                        </div>
                        <div class="stat-card purple">
                            <div class="stat-header">
                                <div class="stat-icon purple"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" /></svg></div>
                                <span class="stat-label">Leader</span>
                            </div>
                            <div class="stat-value" style="font-size: 1.25rem;" x-text="raftMetrics.is_leader ? 'This Node' : 'Node ' + (raftMetrics.leader_id || '-')"></div>
                        </div>
                    </div>
                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" /></svg></div>
                                Cluster Nodes
                            </div>
                        </div>
                        <template x-if="clusterNodes.length > 0">
                            <table>
                                <thead><tr><th>Node ID</th><th>Address</th><th>Role</th><th>Status</th></tr></thead>
                                <tbody>
                                    <template x-for="node in clusterNodes" :key="node.id">
                                        <tr>
                                            <td class="mono" x-text="node.id"></td>
                                            <td class="mono" x-text="node.addr"></td>
                                            <td><span class="badge" :class="node.is_voter ? 'badge-info' : 'badge-warning'" x-text="node.is_voter ? 'Voter' : 'Learner'"></span></td>
                                            <td><span class="badge" :class="node.is_healthy === false ? 'badge-error' : 'badge-success'"><span class="badge-dot"></span><span x-text="node.is_healthy === false ? 'Unhealthy' : 'Healthy'"></span></span></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                        <template x-if="clusterNodes.length === 0">
                            <div class="empty-state">
                                <div class="empty-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" /></svg></div>
                                <h3>Standalone Mode</h3>
                                <p>Running as a single node</p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Metrics View -->
                <div class="view" :class="{ active: currentView === 'metrics' }">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" /></svg></div>
                                <span class="stat-label">Total Requests</span>
                            </div>
                            <div class="stat-value" x-text="formatNumber(serverStatus.total_requests || 0)"></div>
                        </div>
                        <div class="stat-card purple">
                            <div class="stat-header">
                                <div class="stat-icon purple"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" /></svg></div>
                                <span class="stat-label">Connections</span>
                            </div>
                            <div class="stat-value" x-text="serverStatus.active_connections || 0"></div>
                        </div>
                    </div>
                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" /></svg></div>
                                Server Information
                            </div>
                        </div>
                        <div style="padding: 1rem 1.25rem;">
                            <div class="info-row"><span class="info-label">Status</span><span class="badge" :class="serverStatus.status === 'healthy' ? 'badge-success' : 'badge-warning'" x-text="serverStatus.status || 'Unknown'"></span></div>
                            <div class="info-row"><span class="info-label">Mode</span><span class="info-value" x-text="serverStatus.mode || 'Standalone'"></span></div>
                            <div class="info-row"><span class="info-label">Node ID</span><span class="info-value" x-text="serverStatus.node_id || '-'"></span></div>
                            <div class="info-row"><span class="info-label">Uptime</span><span class="info-value" x-text="formatUptime(uptimeSecs)"></span></div>
                        </div>
                    </div>
                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <div class="table-title-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" /></svg></div>
                                Prometheus Metrics
                            </div>
                        </div>
                        <div style="padding: 1.25rem;">
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">Prometheus metrics are available at <code style="background: var(--bg-tertiary); padding: 0.125rem 0.5rem; border-radius: 4px; font-family: 'JetBrains Mono', monospace;">/metrics</code></p>
                            <a href="/metrics" target="_blank" class="btn btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:16px;height:16px;"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" /></svg>
                                Open Prometheus Metrics
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function dashboard() {
            return {
                currentView: 'overview',
                connected: false,
                isRefreshing: false,
                refreshInterval: null,
                lastRefresh: null,
                uptimeSecs: 0,
                serverStatus: {},
                topics: [],
                consumerGroups: [],
                clusterNodes: [],
                raftMetrics: {},
                topicSearch: '',

                get viewTitle() {
                    const titles = { 'overview': 'Dashboard', 'topics': 'Topics', 'groups': 'Consumer Groups', 'cluster': 'Cluster Nodes', 'metrics': 'Metrics' };
                    return titles[this.currentView] || 'Dashboard';
                },
                get filteredTopics() {
                    if (!this.topicSearch) return this.topics;
                    const search = this.topicSearch.toLowerCase();
                    return this.topics.filter(t => t.name.toLowerCase().includes(search));
                },
                get totalPartitions() { return this.topics.reduce((sum, t) => sum + (t.partitions || 1), 0); },
                get totalMessages() { return this.topics.reduce((sum, t) => sum + (t.message_count || 0), 0); },
                get totalLag() { return this.consumerGroups.reduce((sum, g) => sum + (g.total_lag || 0), 0); },

                formatNumber(num) {
                    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                    return num.toString();
                },
                formatUptime(secs) {
                    if (!secs) return '-';
                    const days = Math.floor(secs / 86400);
                    const hours = Math.floor((secs % 86400) / 3600);
                    const mins = Math.floor((secs % 3600) / 60);
                    if (days > 0) return days + 'd ' + hours + 'h';
                    if (hours > 0) return hours + 'h ' + mins + 'm';
                    return mins + 'm';
                },
                getLagClass(lag) {
                    if (lag === 0 || lag < 1000) return 'good';
                    if (lag < 10000) return 'warning';
                    return 'error';
                },

                async init() {
                    await this.refreshData();
                    this.refreshInterval = setInterval(() => this.refreshData(), 3000);
                },

                async refreshData() {
                    if (this.isRefreshing) return;
                    this.isRefreshing = true;
                    const apiBase = window.location.origin;
                    
                    try {
                        const healthRes = await fetch(apiBase + '/health');
                        if (healthRes.ok) {
                            const health = await healthRes.json();
                            this.serverStatus = {
                                status: health.status,
                                node_id: health.node_id_str,
                                mode: health.cluster_mode ? 'Cluster' : 'Standalone',
                                is_leader: health.is_leader,
                                leader_id: health.leader_id
                            };
                            this.connected = true;
                        }

                        const metricsRes = await fetch(apiBase + '/metrics/json');
                        if (metricsRes.ok) { this.raftMetrics = await metricsRes.json(); }

                        const membershipRes = await fetch(apiBase + '/membership');
                        if (membershipRes.ok) {
                            const membership = await membershipRes.json();
                            this.clusterNodes = membership.nodes || [];
                        }

                        const dashboardRes = await fetch(apiBase + '/dashboard/data');
                        if (dashboardRes.ok) {
                            const data = await dashboardRes.json();
                            this.topics = data.topics || [];
                            this.consumerGroups = data.consumer_groups || [];
                            this.serverStatus.active_connections = data.active_connections || 0;
                            this.serverStatus.total_requests = data.total_requests || 0;
                            this.uptimeSecs = data.uptime_secs || 0;
                        }

                        this.lastRefresh = Date.now();
                    } catch (e) {
                        console.error('Failed to fetch data:', e);
                        this.connected = false;
                    } finally {
                        this.isRefreshing = false;
                    }
                }
            };
        }
    </script>
</body>
</html>
